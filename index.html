<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... existing head content ... -->
</head>
<body>
    <!-- ========== TUNNEL INTEGRATION START ========== -->
    <!-- Small status panel (top-right corner) -->
    <div id="tunnelStatus" style="position:fixed; top:10px; right:10px; background:white; padding:8px 12px; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.2); z-index:9999; font-size:12px; border-left:4px solid #007bff;">
        <div><strong>Tunnel:</strong> <span id="statusText">Loading...</span></div>
        <div id="urlDisplay" style="margin-top:3px; font-size:10px; word-break:break-all; max-width:250px;"></div>
    </div>
    
    <!-- Hidden loader for GitHub URL -->
    <iframe id="githubLoader" 
            src="https://raw.githubusercontent.com/leoinfotechchinnamanur/leoinfotech/main/TUNNEL_URL.txt" 
            style="display:none;"
            onload="tunnelLoaded(this)"></iframe>
    <!-- ========== TUNNEL INTEGRATION END ========== -->

    <!-- Your existing Blazor app container -->
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">ðŸ—™</span>
    </div>

    <script src="_framework/blazor.webassembly.js"></script>
    
    <!-- Tunnel JavaScript -->
    <script>
        // Function called when iframe loads
        function tunnelLoaded(iframe) {
            try {
                const tunnelUrl = iframe.contentDocument.body.textContent.trim();
                
                if (tunnelUrl && tunnelUrl.startsWith('http')) {
                    // Update UI
                    document.getElementById('statusText').textContent = 'Connected';
                    document.getElementById('urlDisplay').innerHTML = 
                        `<a href="${tunnelUrl}" target="_blank" style="color:#007bff;">${tunnelUrl}</a>`;
                    
                    // Store for later use
                    window.tunnelUrl = tunnelUrl;
                    
                    // Optional: Redirect to tunnel after Blazor loads
                    // setTimeout(() => {
                    //     window.location.href = tunnelUrl;
                    // }, 2000);
                    
                    console.log('Tunnel URL loaded:', tunnelUrl);
                }
            } catch (error) {
                console.error('Tunnel load error:', error);
                document.getElementById('statusText').textContent = 'Error';
                document.getElementById('urlDisplay').textContent = 'Check GitHub TUNNEL_URL.txt';
            }
        }
        
        // Alternative: Direct fetch (if iframe has CORS issues)
        async function loadTunnelDirect() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/leoinfotechchinnamanur/leoinfotech/main/TUNNEL_URL.txt');
                const tunnelUrl = (await response.text()).trim();
                
                if (tunnelUrl.startsWith('http')) {
                    document.getElementById('statusText').textContent = 'Connected';
                    document.getElementById('urlDisplay').innerHTML = 
                        `<a href="${tunnelUrl}" target="_blank">${tunnelUrl}</a>`;
                    window.tunnelUrl = tunnelUrl;
                }
            } catch (error) {
                console.error('Direct fetch failed:', error);
            }
        }
        
        // Try both methods
        setTimeout(loadTunnelDirect, 1000);
    </script>
</body>
</html>
